"use strict";!function(o){var a={model:function(t,a){this.opts=a,this.$target=t,this.$scrollTarget=this.opts.$scrollTarget||t,this.$doc=o(document),this.isLoading=!1,this.pageData=a.pageData,this.noMorePage=!1,this.init()}};a.model.prototype={init:function(){var a=this;o.fn.scrollPager.enable(this.$target),this.$scrollTarget.on("scroll.scroll_pager",debounce(function(t){return a.onScroll()},a.opts.scrollDebounce)),this.opts.loadDataOnInit&&this.loadData()},dispose:function(){this.$scrollTarget.off("scroll.scroll_pager"),this.$target.removeData("scrollpager")},onScroll:function(){return!(!this.$target.data("scrollpager")||this.isLoading||this.noMorePage)&&(this.$scrollTarget.scrollTop()+this.opts.heightOffset>=this.$doc.height()-this.$scrollTarget.height()&&this.loadData())},_getUrl:function(){var t=this.opts.url;return"function"==typeof this.opts.url&&(t=t(this.pageData)),t},loadData:function(){if(this.pageData.p++,this.pageData.total<=this.pageData.p&&(this.noMorePage=!0,this.dispose()),this.pageData.total<this.pageData.p)return!1;this.opts.ajaxOpts.stringifyData&&this.opts.ajaxOpts.data&&(this.opts.ajaxOpts.data=o.extend(!0,this.opts.ajaxOpts.data,this.pageData),this.opts.ajaxOpts.data=JSON.stringify(this.opts.ajaxOpts.data)),this.isLoading=!0,this.opts.showLoading(),this.opts.beforeLoad&&this.opts.beforeLoad.call(this);var s=this,t=this._getUrl();this.jqXHR=o.ajax(t,this.opts.ajaxOpts).done(function(t,a,o){s.opts.afterLoad&&s.opts.afterLoad.call(this,!0,t)}).fail(function(t,a,o){s.log(a),s.opts.afterLoad&&s.opts.afterLoad.call(this,!1,{xhr:a,err:o,Title:"Server Error..."})}).always(function(t,a){s.isLoading=!1,s.opts.hideLoading()})},log:function(t){(window.console||{log:function(){}}).log(t)}},o.fn.scrollPager=function(t){return t=o.extend(!0,{},o.fn.scrollPager.defaults,t),this.each(function(){new a.model(o(this),t)})},o.fn.scrollPager.defaults={url:null,beforeLoad:function(){},afterLoad:function(t,a){},showLoading:function(){},hideLoading:function(){},$scrollTarget:o(window),heightOffset:0,loadDataOnInit:!1,pageData:{p:0,ps:10,total:100},ajaxOpts:{dataType:"json",contentType:"application/json; charset=utf-8",type:"POST",data:{},stringifyData:!0},scrollDebounce:100},o.fn.scrollPager.disable=function(t){return t.data("scrollpager",!1)},o.fn.scrollPager.enable=function(t){return t.data("scrollpager",!0)}}(jQuery);