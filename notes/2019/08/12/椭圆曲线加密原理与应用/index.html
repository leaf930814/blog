<!DOCTYPE html><html class="theme-lattice"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><title>椭圆曲线加密原理与应用 | leaf++ blog</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="leaf"><meta name="designer" content="leaf"><meta name="rating" content="general"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=yes"><meta name="mobile-web-app-capable" content="yes"><meta name="robots" content="index, follow"><meta name="keywords" content="加密算法,前端开发"><link rel="canonical" href="https://leaf930814.github.io/notes/2019/08/12/椭圆曲线加密原理与应用/index.html"><link rel="apple-touch-icon" sizes="57x57" href="/blog/img/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="114x114" href="/blog/img/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="72x72" href="/blog/img/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="144x144" href="/blog/img/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="60x60" href="/blog/img/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="120x120" href="/blog/img/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="76x76" href="/blog/img/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="152x152" href="/blog/img/apple-touch-icon-152x152.png"><link rel="icon" type="image/png" href="/blog/img/favicon-230x230.png" sizes="230x230"><link rel="icon" type="image/png" href="/blog/img/android-chrome-192x192.png" sizes="192x192"><link rel="icon" type="image/png" href="/blog/img/android-chrome-144x144.png" sizes="144x144"><link rel="icon" type="image/png" href="/blog/img/favicon-96x96.png" sizes="96x96"><link rel="icon" type="image/png" href="/blog/img/favicon-16x16.png" sizes="16x16"><link rel="icon" type="image/png" href="/blog/img/favicon-32x32.png" sizes="32x32"><meta name="msapplication-TileColor" content="#2f83cd"><meta name="msapplication-TileImage" content="/blog/img/mstile-144x144.png"><meta property="wb:webmaster" content="a1686eb81db284d5"><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><link rel="stylesheet" href="/blog/css/style.css"><link rel="alternate" href="/blog/atom.xml" title="leaf++ blog"><meta name="description" content="一. 概述由于RSA、AES等国际算法面临高强度算法禁售和被部署后门风险，我国基于ECC椭圆曲线，自研SM2/SM3/SM4/SM9一套安全算法。根据国家整体战略，金融及重要领域要逐步实现国密算法替换，另根据人民银行总体规划，在2022年金融行业要全面应用国密算法。 在FireFly移动金融开发平台中，完善的提供了支持国密算法的加解密算法包。为了更好的使用和推广国密算法，下面具体分析ECC椭圆曲线"><meta name="keywords" content="加密算法"><meta property="og:type" content="article"><meta property="og:title" content="椭圆曲线加密原理与应用"><meta property="og:url" content="https://leaf930814.github.io/notes/2019/08/12/椭圆曲线加密原理与应用/index.html"><meta property="og:site_name" content="leaf++ blog"><meta property="og:description" content="一. 概述由于RSA、AES等国际算法面临高强度算法禁售和被部署后门风险，我国基于ECC椭圆曲线，自研SM2/SM3/SM4/SM9一套安全算法。根据国家整体战略，金融及重要领域要逐步实现国密算法替换，另根据人民银行总体规划，在2022年金融行业要全面应用国密算法。 在FireFly移动金融开发平台中，完善的提供了支持国密算法的加解密算法包。为了更好的使用和推广国密算法，下面具体分析ECC椭圆曲线"><meta property="og:locale" content="zh-cn"><meta property="og:image" content="https://blockfe.github.io/misc/xlogic/post_ecc_01.jpg"><meta property="og:image" content="https://blockfe.github.io/misc/xlogic/post_ecc_02.jpg"><meta property="og:image" content="https://blockfe.github.io/misc/xlogic/post_ecc_03.jpg"><meta property="og:image" content="https://blockfe.github.io/misc/xlogic/post_ecc_04.jpg"><meta property="og:image" content="https://blockfe.github.io/misc/xlogic/post_ecc_05.jpg"><meta property="og:image" content="https://blockfe.github.io/misc/xlogic/post_ecc_06.jpg"><meta property="og:image" content="https://blockfe.github.io/misc/xlogic/post_ecc_07.jpg"><meta property="og:image" content="https://blockfe.github.io/misc/xlogic/post_ecc_08.jpg"><meta property="og:image" content="https://blockfe.github.io/misc/xlogic/post_ecc_09.jpg"><meta property="og:image" content="https://blockfe.github.io/misc/xlogic/post_ecc_10.jpg"><meta property="og:updated_time" content="2019-10-16T04:11:52.464Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="椭圆曲线加密原理与应用"><meta name="twitter:description" content="一. 概述由于RSA、AES等国际算法面临高强度算法禁售和被部署后门风险，我国基于ECC椭圆曲线，自研SM2/SM3/SM4/SM9一套安全算法。根据国家整体战略，金融及重要领域要逐步实现国密算法替换，另根据人民银行总体规划，在2022年金融行业要全面应用国密算法。 在FireFly移动金融开发平台中，完善的提供了支持国密算法的加解密算法包。为了更好的使用和推广国密算法，下面具体分析ECC椭圆曲线"><meta name="twitter:image" content="https://blockfe.github.io/misc/xlogic/post_ecc_01.jpg"><meta name="twitter:site" content="leaf930814"><script>var App={root:"/blog/",isHome:!1,isCate:!1,isTag:!1}</script></head><body class="page-post-detail"><div class="mod-hd"><div class="grid"><div class="mod-logo"><a href="/blog/">BLOG</a></div><span class="mod-hd-toggle" id="J_hdToggle"><i class="fa fa-bars"></i></span><div class="mod-hd-main"><div class="mod-hd-inner"><nav class="mod-nav"></nav><div class="mod-search" id="J_search"><a class="fa fa-search mod-search-ico" id="J_searchTrigger" title="搜索"></a><form id="J_searchForm" method="get" class="mod-search-form" action="/search/"><input type="text" name="query" class="mod-search-ipt" id="J_searchInput" placeholder="搜索"></form></div></div></div></div></div><div class="mod-container"><div class="grid"><div class="mod-main typo"><article class="post"><div class="post-cover"><img src="https://blockfe.github.io/misc/xlogic/post_ecc_banner.jpg" alt="椭圆曲线加密原理与应用"></div><header class="post-hd"><h1 class="post-tit">椭圆曲线加密原理与应用</h1><div class="post-meta">by <a target="_blank" href="https://github.com/" class="post-author">民生Fintech</a> on <span>2019-08-12</span></div><p class="post-subtit" style="display:none"><i class="fa fa-quote-left"></i>由于RSA、AES等国际算法面临高强度算法禁售和被部署后门风险，我国基于ECC椭圆曲线，自研SM2/SM3/SM4/SM9一套安全算法。</p><span style="display:none" id="busuanzi_value_page_pv"></span></header><div class="post-content"><h2 id="一-概述" class="post-heading"><a href="#一-概述" class="headerlink" title="一. 概述"></a>一. 概述<a class="post-anchor" href="#一-概述" aria-hidden="true"></a></h2><p>由于RSA、AES等国际算法面临高强度算法禁售和被部署后门风险，我国基于ECC椭圆曲线，自研SM2/SM3/SM4/SM9一套安全算法。根据国家整体战略，金融及重要领域要逐步实现国密算法替换，另根据人民银行总体规划，在2022年金融行业要全面应用国密算法。</p><p>在FireFly移动金融开发平台中，完善的提供了支持国密算法的加解密算法包。为了更好的使用和推广国密算法，下面具体分析ECC椭圆曲线的加密原理。</p><h2 id="二-椭圆曲线算法原理" class="post-heading"><a href="#二-椭圆曲线算法原理" class="headerlink" title="二. 椭圆曲线算法原理"></a>二. 椭圆曲线算法原理<a class="post-anchor" href="#二-椭圆曲线算法原理" aria-hidden="true"></a></h2><p>椭圆曲线(Elliptic Curve Cryptography)加密算法是一种公钥加密技术，以椭圆曲线理论为基础。利用有限域上椭圆曲线的点构成的Abel群离散对数难解性，实现加密、解密和数字签名。将椭圆曲线中的加法运算与离散对数中的模乘运算相对应，就可以建立基于椭圆曲线的对应密码体制。</p><h2 id="三-椭圆曲线算法优势" class="post-heading"><a href="#三-椭圆曲线算法优势" class="headerlink" title="三. 椭圆曲线算法优势"></a>三. 椭圆曲线算法优势<a class="post-anchor" href="#三-椭圆曲线算法优势" aria-hidden="true"></a></h2><p><img src="https://blockfe.github.io/misc/xlogic/post_ecc_01.jpg" alt></p><h3 id="1-更适合于移动互联网" class="post-heading"><a href="#1-更适合于移动互联网" class="headerlink" title="1. 更适合于移动互联网"></a>1. 更适合于移动互联网<a class="post-anchor" href="#1-更适合于移动互联网" aria-hidden="true"></a></h3><p>在同等加密安全强度下，ECC密钥长度为163bit，而RSA密钥长度为1024bit。ECC加密算法的密钥长度很短，意味着占用更少的存储空间，更低的CPU开销和占用更少的带宽。随着越来越多的用户使用移动设备来完成各种网上活动，ECC加密算法为移动互联网安全提供更好的客户体验。</p><h3 id="2-更好的安全性" class="post-heading"><a href="#2-更好的安全性" class="headerlink" title="2. 更好的安全性"></a>2. 更好的安全性<a class="post-anchor" href="#2-更好的安全性" aria-hidden="true"></a></h3><p>ECC加密算法提供更强的保护，比目前的其他加密算法能更好的防止攻击，使你的网站和基础设施比用传统的加密方法更安全，为移动互联网安全提供更好的保障。</p><h3 id="3-更好的性能" class="post-heading"><a href="#3-更好的性能" class="headerlink" title="3. 更好的性能"></a>3. 更好的性能<a class="post-anchor" href="#3-更好的性能" aria-hidden="true"></a></h3><p>ECC加密算法需要较短的密钥长度来提供更好的安全。</p><h2 id="四-椭圆曲线理论基础" class="post-heading"><a href="#四-椭圆曲线理论基础" class="headerlink" title="四.椭圆曲线理论基础"></a>四.椭圆曲线理论基础<a class="post-anchor" href="#四-椭圆曲线理论基础" aria-hidden="true"></a></h2><h3 id="1-定义" class="post-heading"><a href="#1-定义" class="headerlink" title="1. 定义"></a>1. 定义<a class="post-anchor" href="#1-定义" aria-hidden="true"></a></h3><p>一条椭圆曲线是在射影平面上满足方程</p><p>Y<sup>2</sup>Z + a<sub>1</sub>XYZ + a<sub>3</sub>Yz<sup>2</sup> = X<sup>3</sup>+ a<sub>2</sub>X<sup>2</sup>Z + a<sub>4</sub>XZ<sup>2</sup> + a<sub>5</sub>Z<sup>3</sup></p><p>所有点的集合，且曲线上的每个点都是非奇异（或光滑）的。</p><ul><li><p>该方程是Weierstrass方程，是一个齐次方程。</p></li><li><p>椭圆曲线的形状，并不是椭圆的。只是因为椭圆曲线的描述方程，类似于计算一个椭圆周长的方程，故得名。下面是椭圆曲线的形状：</p></li></ul><p><img src="https://blockfe.github.io/misc/xlogic/post_ecc_02.jpg" alt></p><ul><li>由椭圆曲线的定义可以知道，椭圆曲线是光滑的，所以椭圆曲线上的平常点都有切线。</li></ul><h3 id="2-椭圆曲线上的加法" class="post-heading"><a href="#2-椭圆曲线上的加法" class="headerlink" title="2. 椭圆曲线上的加法"></a>2. 椭圆曲线上的加法<a class="post-anchor" href="#2-椭圆曲线上的加法" aria-hidden="true"></a></h3><p>① 运算法则</p><p>任意取椭圆曲线上两点P、Q （若P、Q两点重合，则做P点的切线）做直线交于椭圆曲线的另一点R’，过R’做y轴的平行线交于R。我们规定P+Q=R。（如图）</p><p><img src="https://blockfe.github.io/misc/xlogic/post_ecc_03.jpg" alt><img src="https://blockfe.github.io/misc/xlogic/post_ecc_04.jpg" alt></p><p>② 运算法则详解</p><ul><li><p>这里的+是从普通加法中抽象出来的加法，他具备普通加法的一些性质，但具体的运算法则显然与普通加法不同。</p></li><li><p>k个相同的点P相加，我们记作kP。如下图：P+P+P = 2P+P = 3P，3P即为P点的3倍点。</p></li></ul><p><img src="https://blockfe.github.io/misc/xlogic/post_ecc_05.jpg" alt></p><h3 id="3-有限域上的椭圆曲线" class="post-heading"><a href="#3-有限域上的椭圆曲线" class="headerlink" title="3. 有限域上的椭圆曲线"></a>3. 有限域上的椭圆曲线<a class="post-anchor" href="#3-有限域上的椭圆曲线" aria-hidden="true"></a></h3><p>① 有限域</p><p>前面讲到的椭圆曲线是定义在实数域上的，实数是连续的，导致了椭圆曲线的连续，但是并不适合用于加密。所以，必须把椭圆曲线变成离散的点，需要把椭圆曲线定义在有限域上（顾名思义，有限域是一种只有由有限个元素组成的域）。</p><p>下面，给出一个有限域Fp，这个域只有有限个元素。</p><p>Fp中只有p（p为素数）个元素0,1,2 …… p-2,p-1；</p><p>Fp 的加法（a+b）法则是a+b≡c (mod p)；即(a+b)÷p的余数和c÷p的余数相同。</p><p>Fp 的乘法(a×b)法则是 a×b≡c (mod p)；</p><p>Fp 的除法(a÷b)法则是 a/b≡c (mod p)；即a×b-1≡c (mod p)；（b-1也是一个0到p-1之间的整数，但满足b×b-1≡1 (mod p)；</p><p>Fp 的单位元是1，零元是0。</p><p>② 可加密椭圆曲线</p><p>同时，并不是所有的椭圆曲线都适合加密。y<sup>2 </sup>= x<sup>3 </sup>+ ax + b是一类可以用来加密的椭圆曲线，也是最为简单的一类。下面就把 y<sup>2 </sup>= x<sup>3 </sup>+ ax + b这条曲线定义在Fp上：</p><p>选择两个满足下列条件的小于p(p为素数)的非负整数a、b</p><p>4a<sup>3</sup> + 27b<sup>2</sup> ≠ 0 (mod p)</p><p>则满足下列方程的所有点(x,y)，再加上无穷远点O∞ ，构成一条椭圆曲线。</p><p>y<sup>2</sup> = x<sup>3 </sup>+ ax + b(mod p)</p><p>其中x,y属于0到p-1间的整数，并将这条椭圆曲线记为Ep(a,b)。</p><p>示例：查看 y<sup>2</sup> = x<sup>3</sup> + x + 1 (mod 23)的图像</p><p><img src="https://blockfe.github.io/misc/xlogic/post_ecc_06.jpg" alt></p><p>这样椭圆曲线，就成了一个一个离散的点，椭圆曲线在不同的数域中会呈现出不同的样子，但其本质仍是一条椭圆曲线。</p><p>③ 计算椭圆曲线上点的坐标</p><p>Fp上的椭圆曲线同样有加法，根据加法法则，可以计算出椭圆曲线上点的坐标。</p><p>已知点P(x<sub>1</sub>, y<sub>1</sub>), Q(x<sub>2</sub>,y<sub>2</sub>)，计算点R(x<sub>3</sub>, y<sub>3</sub>)：</p><p>X<sub>3</sub> ≡ k<sup>2</sup> – x<sub>1</sub> – y<sub>1</sub> (mod p)</p><p>Y<sub>3</sub> ≡ k(x<sub>1</sub>–x<sub>3</sub>) –y<sub>1</sub> (mod p)</p><p>若P≠Q，PQR三点共线，其斜率 k=(y<sub>2</sub>–y<sub>1</sub>) / (x<sub>2</sub> –x<sub>1</sub>) 。</p><p>其中若P=Q，PR为过P点的椭圆切线，其斜率 k=(3x<sub>1</sub><sup>2</sup>+ a) / 2y<sub>1</sub></p><p>④ 椭圆曲线上的点的阶</p><p>如果椭圆曲线上一点P，存在最小的正整数n，使得数乘nP=O∞，则将n称为P的阶，若n不存在，我们说P是无限阶的。事实上，在有限域上定义的椭圆曲线上所有的点的阶n都是存在的。</p><h2 id="五-椭圆曲线加解密原理" class="post-heading"><a href="#五-椭圆曲线加解密原理" class="headerlink" title="五. 椭圆曲线加解密原理"></a>五. 椭圆曲线加解密原理<a class="post-anchor" href="#五-椭圆曲线加解密原理" aria-hidden="true"></a></h2><h3 id="1-加解密依据" class="post-heading"><a href="#1-加解密依据" class="headerlink" title="1. 加解密依据"></a>1. 加解密依据<a class="post-anchor" href="#1-加解密依据" aria-hidden="true"></a></h3><p>公开密钥算法总是要基于一个数学上的难题。比如RSA依据的是：给定两个素数p、q 很容易相乘得到n，而对n进行因式分解却相对困难。那椭圆曲线上有什么难题呢？</p><p>考虑如下等式：</p><p>K=kG [其中K,G为Ep(a,b)上的点，k为小于n（n是点G的阶）的整数]</p><p>给定k和G，根据加法法则，计算K很容易；但给定K和G，求k就相对困难了。这就是椭圆曲线加密算法采用的难题。</p><p>我们把点G称为基点（base point），k（k&lt;n，n为基点G的阶）称为私有密钥（privte key），K称为公开密钥（public key)。</p><p>k = 2，K为G的2倍点;</p><p>k = 3，K为G的3倍点;</p><p>k = 4，K为G的4倍点;</p><p>…</p><p>如果给定椭圆曲线上K为G的一个倍点，如何计算K为G的多少倍？直观上理解，正向计算一个倍点是容易的，反向计算一个点K是G的几倍点则困难的多。因此在椭圆曲线算法中，将倍数k做为私钥，将K做为公钥。</p><h3 id="2-加解密过程" class="post-heading"><a href="#2-加解密过程" class="headerlink" title="2. 加解密过程"></a>2. 加解密过程<a class="post-anchor" href="#2-加解密过程" aria-hidden="true"></a></h3><p>现在我们描述一个利用椭圆曲线进行加密通信的过程：</p><ol><li><p>用户A选定一条椭圆曲线Ep(a,b)，并取椭圆曲线上一点，作为基点G。</p></li><li><p>用户A选择一个私有密钥k，并生成公开密钥K=kG。</p></li><li><p>用户A将Ep(a,b)和点K，G传给用户B。</p></li><li><p>用户B接到信息后，将待传输的明文编码到Ep(a,b)上一点M（编码方法很多，这里不作讨论），并产生一个随机整数r（r&lt;n）。</p></li><li><p>用户B计算点C<sub>1</sub>=M+rK；C<sub>2</sub>=rG。</p></li><li><p>用户B将C<sub>1</sub>、C<sub>2</sub>传给用户A。</p></li><li><p>用户A接到信息后，计算C<sub>1</sub>-kC<sub>2</sub>，结果就是点M。因为</p></li></ol><p>C<sub>1</sub>-kC<sub>2</sub>=M+rK-k(rG)=M+rK-r(kG)=M</p><p>再对点M进行解码就可以得到明文。</p><p>在这个加密通信中，如果有一个偷窥者H ，他只能看到Ep(a,b)、K、G、C<sub>1</sub>、C<sub>2</sub>而通过K、G 求k 或通过C<sub>2</sub>、G求r 都是相对困难的。因此，H无法得到A、B间传送的明文信息。</p><h3 id="3-加解密参数" class="post-heading"><a href="#3-加解密参数" class="headerlink" title="3. 加解密参数"></a>3. 加解密参数<a class="post-anchor" href="#3-加解密参数" aria-hidden="true"></a></h3><p>密码学中，描述一条Fp上的椭圆曲线，常用到六个参数：</p><pre><code>T=(p,a,b,G,n,h)。
</code></pre><p>p 、a 、b 用来确定一条椭圆曲线，</p><p>G为基点，</p><p>n为点G的阶，</p><p>h 是椭圆曲线上所有点的个数m与n相除的整数部分。</p><p>这几个参数取值的选择，直接影响了加密的安全性。参数值一般要求满足以下几个条件：</p><ol><li><p>p 当然越大越安全，但越大，计算速度会变慢，200位左右可以满足一般安全要求；</p></li><li><p>p≠n×h；</p></li><li><p>pt≠1 (mod n)，1≤t&lt;20；</p></li><li><p>4a<sup>3</sup> + 27b<sup>2</sup> ≠ 0 (mod p)；</p></li><li><p>n 为素数；</p></li><li><p>h≤4。</p></li></ol><h2 id="六-椭圆曲线数字签名原理-ECDSA" class="post-heading"><a href="#六-椭圆曲线数字签名原理-ECDSA" class="headerlink" title="六.椭圆曲线数字签名原理(ECDSA)"></a>六.椭圆曲线数字签名原理(ECDSA)<a class="post-anchor" href="#六-椭圆曲线数字签名原理-ECDSA" aria-hidden="true"></a></h2><h3 id="1-概述" class="post-heading"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述<a class="post-anchor" href="#1-概述" aria-hidden="true"></a></h3><p>椭圆曲线数字签名算法（ECDSA）是使用椭圆曲线密码（ECC）对数字签名算法（DSA）的模拟。</p><p>ECDSA是ECC与DSA的结合，整个签名过程与DSA类似，所不一样的是签名中采取的算法为ECC，最后签名出来的值也是分为r,s。</p><h3 id="2-签名过程" class="post-heading"><a href="#2-签名过程" class="headerlink" title="2. 签名过程"></a>2. 签名过程<a class="post-anchor" href="#2-签名过程" aria-hidden="true"></a></h3><ol><li><p>选择一条椭圆曲线Ep(a,b)，和基点G；</p></li><li><p>选择私有密钥k（k&lt;n，n为G的阶），利用基点G计算公开密钥K=kG；</p></li><li><p>产生一个随机整数r（r&lt;n），计算点R=rG；</p></li><li><p>将原数据和点R的坐标值x,y作为参数，计算SHA1做为hash，即Hash=SHA1(原数据,x,y)；</p></li><li><p>计算s≡r - Hash * k (mod n)；</p></li><li><p>r和s做为签名值，如果r和s其中一个为0，重新从第3步开始执行。</p></li></ol><h3 id="3-验签过程" class="post-heading"><a href="#3-验签过程" class="headerlink" title="3. 验签过程"></a>3. 验签过程<a class="post-anchor" href="#3-验签过程" aria-hidden="true"></a></h3><p>接受方在收到消息(m)和签名值(r,s)后，进行以下运算：</p><ol><li><p>计算：sG+H(m)P=(x1,y1), r1≡x1 mod p。</p></li><li><p>验证等式：r1 ≡r mod p。</p></li><li><p>如果等式成立，接受签名，否则签名无效。</p></li></ol><h2 id="七-椭圆曲线算法应用" class="post-heading"><a href="#七-椭圆曲线算法应用" class="headerlink" title="七.椭圆曲线算法应用"></a>七.椭圆曲线算法应用<a class="post-anchor" href="#七-椭圆曲线算法应用" aria-hidden="true"></a></h2><p>椭圆加密算法的应用范围很广，如 TLS、openPGP以及SSH都在使用，在比特币以及其他加密数字货币中也得到广泛使用。另外我国重点推广的国密SM2算法也正是基于椭圆曲线算法。下面以SM2和TLS为例进行说明：</p><h3 id="1-SM2" class="post-heading"><a href="#1-SM2" class="headerlink" title="1. SM2"></a>1. SM2<a class="post-anchor" href="#1-SM2" aria-hidden="true"></a></h3><p>① 概述</p><p>SM2算法和RSA算法都是公钥密码算法，随着密码技术和计算技术的发展，目前常用的1024位RSA算法面临严重的安全威胁，我们国家密码管理部门经过研究，决定采用SM2椭圆曲线算法替换RSA算法。SM2算法在安全性、性能上都具有优势，参见表1算法攻破时间，表2算法性能。</p><table><thead><tr><th>RSA密钥强度</th><th>椭圆曲线密钥强度</th><th>是否攻破</th></tr></thead><tbody><tr><td>512</td><td>106</td><td>已被攻破</td></tr><tr><td>768</td><td>132</td><td>已被攻破</td></tr><tr><td>1024</td><td>160</td><td>-</td></tr><tr><td>2048</td><td>210</td><td>-</td></tr></tbody></table><p>表1 算法攻破时间</p><table><thead><tr><th>算法</th><th>签名速度(次/秒)</th><th>验签速度(次/秒)</th></tr></thead><tbody><tr><td>1024位RSA</td><td>2792</td><td>51224</td></tr><tr><td>2048位RSA</td><td>455</td><td>15122</td></tr><tr><td>256位SM2</td><td>4095</td><td>871</td></tr></tbody></table><p>表2 算法性能</p><p>② SM2和椭圆曲线算法之间的关系</p><p>SM2算法采用的椭圆曲线方程为：y<sup>2</sup>= x<sup>3</sup>+ ax + b,在SM2算法标准中，通过指定a、b系数，确定了唯一的标准曲线。同时，为了将曲线映射为加密算法，SM2标准中还确定了其它参数，供算法程序使用。</p><p>③ SM2加解密过程</p><p>下面是SM2加解密流程中使用到的符号缩略语：</p><p>A, B 使用公钥密码系统的两个用户。</p><p>dB 用户B 的私钥。</p><p>E(Fq) Fq 上椭圆曲线E 的所有有理点(包括无穷远点O)组成的集合。</p><p>Fq 包含q 个元素的有限域。</p><p>G 椭圆曲线的一个基点，其阶为素数。</p><p>Hash() 密码杂凑算法。</p><p>Hv( ) 消息摘要长度为v 比特的密码杂凑算法。</p><p>KDF( ) 密钥派生函数。</p><p>h 余因子，h=#E(Fq)/n，其中n 是基点G 的阶。</p><p>M 待加密的消息。</p><p>M’ 解密得到的消息。</p><p>n 基点G 的阶(n 是#E(Fq)的素因子)。</p><p>O 椭圆曲线上的一个特殊点，称为无穷远点或零点，是椭圆曲线加法群的单位元。</p><p>PB 用户B 的公钥。</p><p>q 有限域Fq 中元素的数目。</p><p>a, b Fq 中的元素，它们定义Fq 上的一条椭圆曲线E。</p><p>x||y x 与y 的拼接，x、y 是比特串或字节串。</p><p>[k]P 椭圆曲线上点P 的k 倍点。</p><p>E(Fq) E(Fq)上点的数目，称为椭圆曲线E(Fq)的阶。</p><p>M⊕t xor运算</p><p>a. 加密算法流程</p><p>SM2加密使用公钥加密，公钥由一个曲线坐标点组成，在X.509证书中的公钥表示为04标记开始的2个32byte的BigInteger，即曲线点P（x,y）。SM2公钥加密算法比RSA相对复杂，加密结果由3个部分组成，SM2加密过程中使用了随机数，因此同样的明文数据每一次加密结果都不一样。</p><p>设需要发送的消息为比特串M，klen 为M 的比特长度。</p><p>为了对明文M 进行加密，作为加密者的用户A 应实现以下运算步骤：</p><p>A1：用随机数发生器产生随机数k∈[1, n-1]；</p><p>A2：计算椭圆曲线点C1 = [k]G=(x1, y1)，按SM2 椭圆曲线公钥密码算法第1 部分3.2.9 和3.2.5 给</p><p>出的方法，将C1 的数据类型转换为比特串；</p><p>A3：计算椭圆曲线点S= [h]PB，若S 是无穷远点，则报错并退出；</p><p>A4：计算椭圆曲线点[k]PB=(x2, y2)，按SM2 椭圆曲线公钥密码算法第1 部分3.2.6 和3.2.5 给出的</p><p>方法，将坐标x2、y2 的数据类型转换为比特串；</p><p>A5：计算t = KDF(x2||y2，klen)，若t 为全0 比特串，则返回A1；</p><p>A6：计算C2=M⊕t；</p><p>A7：计算C3= Hash (x2||M|| y2)；</p><p>A8：输出密文C=C1||C3||C2。</p><p><img src="https://blockfe.github.io/misc/xlogic/post_ecc_07.jpg" alt></p><p>根据国密推荐的SM2椭圆曲线公钥密码算法，首先产生随机数计算出曲线点C1，2个32byte的BigInteger大数，即为SM2加密结果的第1部分。第2部分则是真正的密文，是对明文的加密结果，长度和明文一样。第3部分是杂凑值，用来效验数据。按国密推荐的256位椭圆曲线，明文加密结果比原长度会大96byte。</p><p>b. 解密算法流程</p><p>SM2解密算法是加密逆运算。首先需要从密文中取出加密结果的3部分值，然后通过私钥计算出M’明文值，最后效验数据</p><p>设klen 为密文中C2 的比特长度。</p><p>为了对密文C=C1||C3||C2 进行解密，作为解密者的用户B 应实现以下运算步骤：</p><p>B1：从C 中取出比特串C1，按SM2 椭圆曲线公钥密码算法第1 部分3.2.4 和3.2.10 给出的方法，</p><p>将C1 的数据类型转换为椭圆曲线上的点，验证C1 是否满足椭圆曲线方程，若不满足则报错</p><p>并退出；</p><p>B2：计算椭圆曲线点S= [h]C1，若S 是无穷远点，则报错并退出；</p><p>B3：计算[dB]C1= (x2, y2)，按SM2 椭圆曲线公钥密码算法第1 部分3.2.6 和3.2.5 给出的方法，将</p><p>坐标x2、y2 的数据类型转换为比特串；</p><p>B4：计算t = KDF(x2||y2，klen)，若t 为全0 比特串，则报错并退出；</p><p>B5：从C 中取出比特串C2，计算M’=C2⊕t；</p><p>B6：计算u = Hash (x2||M’|| y2)，从C 中取出比特串C3，若u≠C3，则报错并退出；</p><p>B7：输出明文M’。</p><p><img src="https://blockfe.github.io/misc/xlogic/post_ecc_08.jpg" alt></p><p>SM2解密同样也可以使用软算法实现。但因为涉及到私钥运算，为保护私钥安全，建议在硬件设备中运行，例如UKey等存储介质这样可以更好的保护密钥安全。拿文件加密来说，首先拿UKey里面的加密证书加密，这部分可在应用系统内完成。解密的话则需要加密证书对应UKey才能做解密，由应用系统调用UKey解密接口，在物理硬件内完成数据解密，同时可以受设备PIN码保护。</p><p>④ SM2算法的速度和结果长度</p><p>简单讲，SM2签名速度快，验签速度慢，这点和RSA算法的特性正好相反。参见上表2。另外，加解密速度和验签速度相当。</p><p>SM2支持近128G字节数据长度，加密结果增加96个字节。</p><p>SM2签名算法对原始数据量长度无限制，签名结果为64字节。</p><h3 id="2-TLS" class="post-heading"><a href="#2-TLS" class="headerlink" title="2. TLS"></a>2. TLS<a class="post-anchor" href="#2-TLS" aria-hidden="true"></a></h3><p>① 概述</p><p>HTTPS 通过TLS 层和证书机制提供了内容加密、身份认证和数据完整性三大功能，可以有效防止数据被监听或篡改，还能抵御MITM（中间人）攻击。TLS 在实施加密过程中，需要用到非对称密钥交换和对称内容加密两大算法。对称内容加密强度非常高，加解密速度也很快，只是无法安全地生成和保管密钥。在TLS 协议中，应用数据都是经过对称加密后传输的，传输中所使用的对称密钥，则是在握手阶段通过非对称密钥交换而来。</p><p>② TLS中密钥交换算法</p><p>目前最常用的密钥交换算法有RSA 和ECDHE：RSA 历史悠久，支持度好，但不支持PFS（Perfect Forward Secrecy）；而ECDHE 是使用了ECC（椭圆曲线）的DH（Diffie-Hellman）算法，计算速度快，支持PFS。</p><p>③ 基于ECC的密钥交换算法</p><p>下面是五种常见的基于ECC的TLS 密钥交换算法，它们分别模仿DH_DSS，DHE_DSS，DH_RSA，DHE_RSA和DH_anon。</p><p><img src="https://blockfe.github.io/misc/xlogic/post_ecc_09.jpg" alt></p><p>以ECDHE_ECDSA为例：</p><p>证书包含ECDSA-capable 公钥，使用ECDHE 算法协商预备主密钥; 证书必须允许密钥用于使用将在Server 密钥交换消息中使用的散列算法进行签名;公钥必须使用一个能够被Client 支持的曲线和点格式，Client 通过Client Hello 消息中的ec_point_formats 扩展指定支持的命名曲线，正如 [TLSECC] 中描述的那样。这是TLS 1.2 中最安全，性能最高的密码套件。</p><p>④ ECDHE密钥交换的完整握手流程</p><p>A: 客户端向服务器发送Client Hello,告知服务器，客户端支持的协议版本、加密套件等信息。</p><p>B: a. 服务端收到响应，选择双方都支持的协议、套件，向客户端发送Server Hello，同时服务器也将自己的证书发送到客户端(Certificate)。</p><p>b. 服务器利用私钥将客户端随机数、服务器随机数、服务器DH参数签名，生成服务器签名。</p><p>C: 服务端向客户端发送服务器DH参数以及服务器签名(Server Key Exchange)。</p><p>D: 客户端向服务端发送客户端DH参数(Client Key Exchange)。</p><p>之后，客户端利用公钥验证服务器签名，客户端与服务器各自利用服务端DH参数、客户端DH参数生成预主密钥，再通过预主密钥、客户端随机数、服务端随机数生成主密钥(会话密钥)。最后握手完成，所有的消息都通过主密钥加密。如图：</p><p><img src="https://blockfe.github.io/misc/xlogic/post_ecc_10.jpg" alt></p><h2 id="八-结语" class="post-heading"><a href="#八-结语" class="headerlink" title="八. 结语"></a>八. 结语<a class="post-anchor" href="#八-结语" aria-hidden="true"></a></h2><p>椭圆曲线ECC算法基于椭圆曲线理论，可以用较少的计算能力提供更高的安全强度，有效地解决了“提高安全强度必须增加密钥长度”的工程实现问题，且已经得到广泛的支持和使用，读者在选择加密算法时，ECC算法不失为一个优秀的选择。</p><h2 id="九-参考资料" class="post-heading"><a href="#九-参考资料" class="headerlink" title="九. 参考资料"></a>九. 参考资料<a class="post-anchor" href="#九-参考资料" aria-hidden="true"></a></h2><p>ECC加密算法入门介绍</p><p><a href="https://www.pediy.com/kssd/pediy06/pediy6014.htm" target="_blank" rel="noopener">https://www.pediy.com/kssd/pediy06/pediy6014.htm</a></p><p>Elliptic Curve Cryptography: a gentle introduction</p><p><a href="https://andrea.corbellini.name/2015/05/17/elliptic-curve-cryptography-a-gentle-introduction/" target="_blank" rel="noopener">https://andrea.corbellini.name/2015/05/17/elliptic-curve-cryptography-a-gentle-introduction/</a></p><p>国家密码管理局</p><p><a href="http://www.oscca.gov.cn/" target="_blank" rel="noopener">http://www.oscca.gov.cn/</a></p><p>国家商用密码（一）SM2椭圆曲线公钥密码算法</p><p><a href="http://www.firstsolver.com/wordpress/?p=1938" target="_blank" rel="noopener">http://www.firstsolver.com/wordpress/?p=1938</a></p><p>TLS_ECC</p><p><a href="https://tools.ietf.org/html/rfc4492" target="_blank" rel="noopener">https://tools.ietf.org/html/rfc4492</a></p><div class="post-tags" style="display:none"><a href="/blog/tags/加密算法/">加密算法</a></div><div class="post-categories" style="display:none"><a href="/blog/cates/Web开发/">Web开发</a></div><div class="post-revision"><i class="fa fa-clock-o"></i> <time class="post-updated" datetime="2019-10-16T04:11:52.464Z">上次更新：2019-10-16 12:11:52</time></div></div><div class="post-nav"><div class="post-nav-next"><a href="/blog/notes/2019/09/20/《白帽子讲WEB安全》读书笔记/" title="《白帽子讲WEB安全》读书笔记">《白帽子讲WEB安全》读书笔记 <i class="fa fa-chevron-right"></i></a></div><div class="post-nav-prev"><a href="/blog/notes/2019/05/16/to-improve-debug-efficiency/" title="Sentry - 及时发现Bug，提高Debug效率"><i class="fa fa-chevron-left"></i> Sentry - 及时发现Bug，提高Debug效率</a></div></div><div class="post-comments" id="comments"></div><script>var gitalkOpts={id:"bm90ZXMvMjAxOS8wOC8xMi/mpK3lnIbmm7Lnur/liqDlr4bljp/nkIbkuI7lupTnlKgv",owner:"leaf930814",repo:"blog",title:"椭圆曲线加密原理与应用",body:"https://leaf930814.github.io/notes/2019/08/12/椭圆曲线加密原理与应用/index.html\n\n由于RSA、AES等国际算法面临高强度算法禁售和被部署后门风险，我国基于ECC椭圆曲线，自研SM2/SM3/SM4/SM9一套安全算法。",clientID:"f82f526a1c32792164ec",clientSecret:"79d5ef9dcad726e7945c109a7b9ae15f01c72035",admin:["mamboer"]}</script></article></div><aside class="mod-side" id="sidebar"><div class="mod-side-sec works"><div class="mod-side-sec-hd"><h2>服务/产品</h2></div><div class="mod-side-sec-bd"><ul class="mod-side-list"><li><a href="https://www.gxbui.com/demo.html" target="_blank" title="GXB-UI">GXB-UI</a></li></ul></div></div><div class="mod-side-sec favlinks"><div class="mod-side-sec-hd"><h2>社区/其他</h2></div><div class="mod-side-sec-bd"><ul class="mod-side-list"><li><a href="https://www.gxchain.org/" target="_blank" title="GXChain Official Website">GXChain</a></li><li><a href="https://www.cnblogs.com/leaf930814/" target="_blank" title="My Cnblogs">我的cnblogs博客</a></li></ul></div></div></aside></div></div><div class="mod-backtop" id="backTop"><i class="fa fa-long-arrow-up"></i></div><footer class="mod-ft" id="footer"><div class="grid"><ul class="mod-ft-links"><li><a href="/blog/atom.xml"><i class="fa fa-rss"></i></a></li><li><a href="https://github.com/leaf930814/blog" target="_blank"><i class="fa fa-github-alt"></i></a></li></ul><div class="mod-ft-sec mod-ft-copyright"><p>Copyright &copy; 2019. All Rights Reserved.</p></div></div></footer><script src="/blog/js/libs/debounce.js"></script><script src="/blog/js/libs/jquery.js"></script><script src="/blog/js/libs/jquery.scrollPager.js"></script><script src="/blog/js/libs/hogan-3.0.2.js"></script><script src="/blog/js/libs/base64.js"></script><script src="/blog/js/mods/util.js"></script><script src="/blog/js/mods/common.js"></script><script src="/blog/js/mods/console.js"></script><script src="/blog/js/mods/scrollPager.js"></script><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script src="/blog/js/post_wx_share.js"></script><script src="/blog/js/libs/ua-parser.js"></script><script src="/blog/js/mods/gitalk.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script type="text/javascript" src="https://tajs.qq.com/stats?sId=53685723" charset="UTF-8"></script></body></html>